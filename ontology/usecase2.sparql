
PREFIX crm: <http://erlangen-crm.org/240307/>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX base: <http://www.semanticweb.org/berka/ontologies/2025/10/untitled-ontology-3#>

SELECT ?groupName ?spaceName ?description ?locationName ?restrictionStatus
WHERE {
  # 1. Find the Space
  ?e25 a crm:E25_Human-Made_Feature ;
       crm:P55_has_current_location ?location ;
       crm:P3_has_note ?note .
  # 2. Find the Owner (Group)
  ?group a crm:E74_Group ;
         crm:P52i_is_current_owner_of ?e25 .
  # 3. FILTER: Matches your Competency Question keywords
  FILTER (
    regex(LCASE(STR(?note)), "community|meeting|civic", "i")
  )
  # 4. CHECK RESTRICTION (The key addition)
  OPTIONAL { 
    ?e25 crm:P104_is_subject_to ?right . 
  }
  # 5. Formatting
  BIND(STRAFTER(STR(?group), "#") AS ?groupName)
  BIND(STRAFTER(STR(?e25), "#") AS ?spaceName)
  BIND(STR(?note) AS ?description)
  BIND(STRAFTER(STR(?location), "#") AS ?locationName)
  # 6. Restriction Formatting: If a restriction exists, show it. If not, assume "Public / Open Access"
  BIND(
    IF(BOUND(?right), STRAFTER(STR(?right), "#"), "Public / Open Access") 
    AS ?restrictionStatus
  )
}
ORDER BY ?groupName
